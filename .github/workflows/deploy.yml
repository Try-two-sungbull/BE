name: Deploy to Coolify
on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Coolify deploy
        run: |
          set -e
          echo "Triggering Coolify deploy..."
          code=$(curl -sS -o /tmp/resp.txt -w "%{http_code}" -X POST \
            -H "Authorization: Bearer ${{ secrets.COOLIFY_TOKEN }}" \
            "http://59.0.206.50:8000/api/v1/deploy?uuid=yc80ooo8oowcwogw4ss8goc4&force=false")
          echo "HTTP $code"
          echo "--- response ---"
          cat /tmp/resp.txt
          echo "---------------"
          if [ "$code" -lt 200 ] || [ "$code" -ge 300 ]; then
            exit 1
          fi
